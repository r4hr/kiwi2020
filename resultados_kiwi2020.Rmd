---
title: "Presentación de Resultados Encuesta KIWI 2020"
author: "Club de R para RRHH"
date: "12/11/2020"
output: 
  html_document:
    theme: cosmo
    highlight: haddock
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.retina = 3, out.width = "70%", fig.align = "center")
```

# Introducción

El [Club de R para RRHH](https://r4hr.club) es una comunidad de aprendizaje de programación de R, destinada a los profesionales y estudiantes que trabajan o quieren trabajar en el área.

Somos una comunidad que usa mayormente datos de ejemplo relacionados con RRHH, y que genera contenido en castellano para eliminar las barreras en el aprendizaje y facilitar que más personas adopten las herramientas de análisis de datos en sus trabajos.

Para saber más de nosotros te invitamos a leer [este post](https://r4hr.club/2020/09/23/el-club-de-r-para-rrhh/).

```{r preproceso}

library(tidyverse)      # Transformar y limpiar datos
library(googlesheets4)  # Leer datos desde Google Sheets
library(gargle)         # Corregir lectura de símbolos especiales desde Google Sheets
library(gt)             # Dar formato a las tablas
library(extrafont)      # Permite utilizar otras fuentes en los gráficos y salidas
library(ggthemes)       # Amplía las posibilidades estéticas de ggplot2
library(scales)         # Permite cambiar los formatos de decimales, de porcentajes, etc.
library(ggalt)          # Nuevos tipos de geom para ggplot2. Para realizar el gráfico de gap salarial
library(funModeling)    # Para explorar datos y modelos
library(forcats)
library(DT)

options(scipen = 999)   # Modifica la visualización de los ejes numérico a valores nominales

loadfonts(quiet = TRUE) # Permite cargar en R otros tipos de fuentes.

# Estilo limpio sin líneas de fondo
estilo <- theme(panel.grid = element_blank(),
                plot.background = element_rect(fill = "#FBFCFC"),
                panel.background = element_blank(),
                text = element_text(family = "Roboto"))

# Estilo limpio con líneas de referencia verticales en gris claro
estilov <- theme(panel.grid = element_blank(),
                 plot.background = element_rect(fill = "#FBFCFC"),
                 panel.background = element_blank(),
                 panel.grid.major.x = element_line(color = "#AEB6BF"),
                 text = element_text(family = "Roboto"))

# Estilo limpio con líneas de referencia horizontales en gris claro
estiloh <- theme(panel.grid = element_blank(),
                 plot.background = element_rect(fill = "#FBFCFC"),
                 panel.background = element_blank(),
                 panel.grid.major.y = element_line(color = "#AEB6BF"),
                 text = element_text(family = "Roboto"))

genero <- c("#8624F5", "#1FC3AA", "#FFD129", "#75838F") #Violeta - Verde - Amarillo - Gris
genero3 <- c("#8624F5","#FFD129", "#1FC3AA")

colores <-  c("#8624F5", "#1FC3AA")

azul <- "#344D7E"
verde <-  "#009204"
gris <- "#75838F"

# Creo un objeto con un texto que se va a repetir mucho a lo largo del análisis
fuente <- "Fuente: Encuesta KIWI de Sueldos de RRHH para Latam"


# Carga de datos

original <- sheets_read("1aeuu9dVfN42EjyvbmhEcsf0ilSz2DiXU-0MpnF896ss")
tipo_cambio <- sheets_read("1tEc4-_gXJi4lJ_Bj_ysleC-O01jiVOumOQCxGQ1tShM") %>% 
  select(pais, tipo_cambio)


# Preprocesamiento 
kiwi <- original

limpios <- make.names(colnames(kiwi))
colnames(kiwi) <- limpios

rm(limpios)

kiwi <- kiwi %>% 
  select(-X.Querés.contestar.más.preguntas....31, 
         -X.Querés.contestar.más.preguntas....42) %>% 
  rename(genero = Género,
         genero_diverso = X.Te.identificás.como.LGBT...lesbiana..gay..bisexual..transexual..otra.minoría.sexual..,
         edad = Edad,
         discapacidad = X.Tenés.alguna.discapacidad.,
         nivel_formacion = `Máximo.nivel.de.formación`,
         carrera_grado = X.Qué.carrera.de.grado.estudiaste.,
         tipo_universidad = X.En.qué.tipo.de.universidad.estudiaste.tu.carrera.de.grado.,
         pais = País.en.el.que.trabajas,
         provincia = Provincia.donde.trabajas,
         trabajo = Trabajo,
         rubro = Rubro.de.la.empresa,
         dotacion = X.Cuántos.empleados.tiene.la.empresa.,
         origen_capital = Origen.del.capital,
         dotacion_rh = X.Cuántas.personas.integran.el.área.de.RRHH.,
         puesto = X.En.qué.puesto.trabajás.,
         tipo_contratacion = Tipo.de.contratación,
         funcion_rh = X.Cuál.es.tu.función.principal.en.RRHH.,
         personas_a_cargo = "X.Cuántas.personas.tenés.a.cargo...poné.0.si.no.tenés.gente.a.cargo.",
         anios_en_empresa = "X.Hace.cuántos.años.trabajas.en.la.empresa.donde.estás...0.para.menos.de.un.año.",
         anios_en_puesto = "X.Hace.cuántos.años.estás.en.tu.puesto.actual...0.para.menos.de.un.año.",
         anios_experiencia = X.Cuántos.años.de.experiencia.tenés.en.RRHH.,
         sueldo_bruto = X.Cuál.es.tu.remuneración.BRUTA.MENSUAL.en.tu.moneda.local...antes.de.impuestos.y.deducciones.,
         beneficios = X.Qué.beneficios.tenés.,
         bono = X.Recibís.bonos.,
         ajuste = X.Tuviste.ajustes.por.inflación.en.2020.,
         ajuste_porcentaje = X.Cuál.fue.el.porcentaje.de.aumento.acumulado.que.tuviste.en.2020.,
         ajuste_mes = Mes.del.último.ajuste,
         otros_proyectos = X.Trabajás.en.proyectos.independientes.además.de.tu.empleo.,
         erp = X.Qué.sistema.de.gestión.de.RRHH.usan.en.tu.empresa.,
         nombre_area = X.Cómo.se.llama.el.área.en.tu.empresa.,
         mate = X.Se.podía.tomar.mate.en.las.oficinas.de.tu.empresa...antes.del.COVID.19.,
         idioma_exigencia = X.Te.exigieron.saber.un.idioma.extranjero..inglés..portugués..etc...para.entrar.a.trabajar.en.tu.empresa.,
         idioma_porcentaje = X.Qué.porcentaje.del.tiempo.usas.el.idioma.extranjero.en.tu.puesto.actual.,
         contactos_linkedin = "X.Cuántos.contactos.tenés.en.LinkedIn...poné.0.si.no.tenés.cuenta.de.LinkedIn.",
         satisfaccion = X.Qué.tan.satisfecho.estás.con.tu.empresa.,
         busqueda = X.Estás.buscando.trabajo.,
         beneficios_expectativa = X.Qué.beneficios.te.gustaría.tener.,
         rh_una_palabra = Definí.a.RRHH.con.una.sola.palabra,
         pregunta_bizarra = X.Cuál.es.la.pregunta.más.bizarra.que.te.han.hecho.has.hecho.en.una.entrevista.,
         teletrabajo = X.Estás.trabajando.desde.tu.casa.,
         elementos = X.Qué.elementos.te.proveyó.la.empresa.para.que.puedas.trabajar.desde.tu.casa.,
         valoracion_gestion_empresa = X.Cómo.valorarías.la.gestión.de.tu.empresa.en.este.nuevo.contexto.,
         registro_fiscal = X.Cómo.estás.registrado.a.fiscalmente.,
         anios_freelance = X.Hace.cuántos.años.trabajás.como.freelance.,
         lugar_trabajo = X.Dónde.trabajás.habitualmente...sin.considerar.la.coyuntura.por.COVID.19.,
         exporta = X.Exportás.tus.servicios.,
         medio_pago_exterior = Si.exportás.servicios...a.través.de.qué.medios.de.pago.recibís.los.pagos.del.exterior.,
         cuotas = X.Aceptás.pagos.en.cuotas.,
         colaboracion_freelance = X.Trabajás.con.otros.freelancers.de.tu.mismo.rubro.,
         servicio_busqueda = X.Tu.servicio.principal.está.relacionado.con.búsqueda.y.selección.,
         busqueda_it = X.Te.dedicás.principalmente.a.realizar.búsquedas.de.IT.Tecnología.,
         trabajo_a_riesgo =X.Trabajás.a.riesgo.,
         coeficiente = X.Cuál.es.el.coeficiente.que.cobrás.por.tus.servicios.,
         base_coeficiente = El.coeficiente.lo.calculás.sobre.,
         garantia = X.Ofrecés.garantía.,
         servicio_principal = X.Cuál.es.el.servicio.principal.que.brindas...si.brindás.más.de.un.servicio..elegí.el.que.más.ingresos.genere.,
         valor_hora = X.Cuál.es.el.valor.hora.promedio.que.ofrecés...moneda.local.)

# Base de freelancers
freelo <- kiwi %>% 
  filter(trabajo == "Freelance")

# Base de empleados en relación de dependencia
rh <- kiwi %>% 
  filter(trabajo == "Relación de Dependencia", 
         funcion_rh != "Ninguno",
         funcion_rh != "No me desempeño en el área de RRHH.",
         funcion_rh != "Trabajo en el área de Sistemas.",
         funcion_rh != "No trabajo en el area",
         funcion_rh != "No trabajo en recursos humanos",
         funcion_rh != "No trabajo en Rrhh",
         funcion_rh != "Trabajo en Administración y Finanzas",
         funcion_rh != "Aaa",
         funcion_rh != "IT") %>% 
  mutate(sueldo_bruto = as.numeric(unlist(sueldo_bruto)),
         puesto = factor(puesto))


rh <- rh %>% 
  filter(puesto != "Juzgado Civil y Comercial",
         puesto != "Programador",
         puesto != "Cuidado",
         puesto != "Asesor",
         puesto != "Jefe de Proyecto") %>% 
  mutate(puesto = str_trim(puesto, side = "both"), # Elimina espacios vacíos
         puesto = fct_collapse(puesto, "Gerente" = "Superintendente"),
         puesto = fct_collapse(puesto, "Director" = "Director ( escalafón municipal)"),
         puesto = fct_collapse(puesto, "HRBP" = c("Senior Consultoría", "specialist", "especialista",
                                                  "Especialista en selección IT", "Recruiter")),
         puesto = fct_collapse(puesto, "Responsable" = c("Coordinación", "Coordinador de Payroll",
                                                         "Encargado", "Supervisor")),
         puesto = fct_collapse(puesto, "Administrativo" = c("Asistente", "Asistente RRHH", "Aux", 
                                                            "Capacitador", "Consultor Ejecutivo",
                                                            "consultor jr")),
         puesto = fct_collapse(puesto, "Analista" = c("Asesoramiento", "Consultor", "Generalista", 
                                                      "Reclutadora", "Selectora", "Senior"))) %>% 
  select(Marca.temporal:valoracion_gestion_empresa)

# Pasa los campos de lista a numéricos
rh <- rh %>% 
  mutate(anios_en_empresa  = as.numeric(unlist(anios_en_empresa)),
         anios_en_puesto   = as.numeric(unlist(anios_en_puesto)),
         anios_experiencia = as.numeric(unlist(anios_experiencia)),
         ajuste_porcentaje = as.numeric(unlist(ajuste_porcentaje)))

# Modifica los registros
rh$contactos_linkedin[[150]] <- 800
rh$contactos_linkedin[[214]] <- 500
rh$contactos_linkedin[[222]] <- 1000
rh$contactos_linkedin[[269]] <- 500
rh$contactos_linkedin[[282]] <- 1000
rh$contactos_linkedin[[339]] <- 1000
rh$contactos_linkedin[[382]] <- 30000
rh$contactos_linkedin[[385]] <- 500
rh$contactos_linkedin[[398]] <- 5000
rh$contactos_linkedin[[445]] <- 500
rh$contactos_linkedin[[459]] <- 500
rh$contactos_linkedin[[595]] <- 500
rh$contactos_linkedin[[598]] <- 500

rh <- unnest(data = rh, cols = c(anios_en_empresa, anios_en_puesto, anios_experiencia,
                                 ajuste_porcentaje, contactos_linkedin), keep_empty = TRUE)

# Corregir orden de puestos y simplificar género

rh <- rh %>% 
  mutate(puesto = factor(puesto, levels = c("Pasante", "Administrativo", "Analista",
                                            "HRBP", "Responsable","Jefe",
                                            "Gerente", "Director")),
         genero = fct_recode(genero, "Género Diverso" = "Género diverso (género diverso / género fluido /otras minorías)"))

rh <- rh %>% 
  filter(nivel_formacion != "Secundario en curso") %>% 
  mutate(nivel_formacion = fct_collapse(nivel_formacion, "Universitario completo" = c("Maestría abandonada"),
                                        "Secundario completo" = c("Terciario abandonado", "Terciario en curso", 
                                                                  "Universitario abandonado"),
                                        "Maestría completa" = c("Doctorado en curso")))


# Comparación de sueldos en dólares
rh <- rh %>% 
  left_join(tipo_cambio, by = "pais") %>% 
  mutate(multiplicador = if_else(tipo_contratacion == "Part time", 1.5, 1),
         sueldo_ft = sueldo_bruto * multiplicador,    # Hace la equivalencia de un sueldo part time a full time
         sueldo_dolar = sueldo_ft/tipo_cambio,  # Convierto los sueldos a dólares
         cuenta = 1)

rtas_pais <- rh %>% 
  select(pais) %>% 
  distinct(pais) %>% 
  count() %>% 
  pull()
```

## Motivaciones

Como en RRHH trabajamos con datos sensibles, es complejo conseguir datos para practicar cuando estás aprendiendo sobre People Analytics, especialmente la parte práctica. Por eso, e inspirados en la Encuesta de [SysArmy](https://sysarmy.com/blog/posts/resultados-de-la-encuesta-de-sueldos-2020-2/), una comunidad de tecnología, que entre otras cosas, organiza eventos como **Nerdearla**.

Por esta razón hicimos nuestra propia encuesta, relevando datos de profesionales que trabajan tanto bajo relación de dependencia como de manera freelance. El relevamiento de datos lo hicimos entre el 1° y el 31 de octubre de 2020.

Recibimos en total `r nrow(kiwi)` respuestas de `r rtas_pais` países diferentes.

```{r paises}

# Respuestas por países
paises <- kiwi %>% 
  select(pais) %>% 
  mutate(cuenta = 1) %>% 
  group_by(pais) %>% 
  summarise(Cuenta = sum(cuenta)) %>% 
  arrange(-Cuenta)

gt(paises) %>% 
  tab_header(title = "Cantidad de respuestas por país") %>% 
  tab_source_note(source_note = fuente) %>% 
  cols_label(pais = "País")

```

<br>

Del total de respuestas, `r nrow(rh)` son de personas que trabajan en relación de dependencia en RRHH, y `r nrow(freelo)` trabajan de manera freelance.

```{r tipo_trabajo}
kiwi %>% 
  select(trabajo) %>% 
  group_by(trabajo) %>% 
  count() %>% 
  ggplot(aes(x = n, y = trabajo)) +
  geom_col(fill = azul) +
  estilov +
  labs(title = "Respuestas por tipo de trabajador", 
       x = "", y = "", 
       caption = fuente)

```

La participación según el género entre trabajadores en relación de dependencia:

```{r genero}
div <- rh %>% 
select(genero) %>% 
  mutate(genero = factor(genero, 
                         levels = c("Femenino", "Masculino", "Género Diverso",
                                    "Prefiero no responder"))) %>% 
  group_by(genero) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

# Compute the cumulative percentages (top of each rectangle)
div$ymax <- cumsum(div$freq)

# Compute the bottom of each rectangle
div$ymin <- c(0, head(div$ymax, n=-1))

# Compute label position
div$labelPosition <- (div$ymax + div$ymin) / 2

# Compute a good label
div$label <- paste0(div$genero, "\n Cant: ", div$n)

# Make the plot
ggplot(div, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=genero)) +
  geom_rect() +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(2, 4)) +# Try to remove that to see how to make a pie chart
  scale_fill_manual(values = c("#8624F5",  "#1FC3AA", "#FFD129","#75838F")) +
  theme_void() +
  theme(legend.position = "right",
        panel.background = element_blank(),
        text = element_text(family = "Roboto")) +
  labs(title = "Cantidad de respuestas según género",
       fill = "Género", 
       caption = fuente)

```

# Análisis de remuneraciones

## Remuneraciones por país

En esta sección nos dedicaremos a comparar los sueldos entre los países. En primer lugar, hay que resaltar que los resultados no son representativos de los países, sino que lo son de los datos recolectados.

Por otra parte, la baja cantidad de respuestas recolectaas de otros países fuera de la Argentina, nos hace imposible, hacer un análisis comparado representativo de los puestos. Sin embargo, hay algunos datos intresantes para analizar.

Primero, analicemos los sueldos de los trabajadores en relación de dependencia, de cuyos países hayamos recibido al menos 5 respuestas.

```{r dolar, out.width="100%"}

sueldos_dolar <- rh %>% 
  select(puesto, sueldo_dolar, pais, tipo_contratacion) %>% 
  filter(puesto != "Pasante", tipo_contratacion != "Pasante")

# Eliminamos los sueldos que están dentro del rango entre los percentiles 5 y 95
numericos <- profiling_num(sueldos_dolar)
poda_p05 <- numericos[1,6]
poda_p95 <- numericos[1,10]

# Dado que los percentiles 5 y 95 están en U$400 y 2689 respectivamente, 
# podamos todo lo que esté fuera de ese rango

media_pais <- sueldos_dolar %>% 
  filter(pais %in% c("Argentina", "Bolivia", "Chile", "Paraguay", "Uruguay", "Perú"),
         between(sueldo_dolar,poda_p05,poda_p95)) %>% 
  group_by(pais) %>% 
  summarise(sueldop = list(mean_se(sueldo_dolar))) %>% 
  unnest(cols = c(sueldop)) 
 
sueldo_dolar_pais <- rh %>% 
  select(pais, sueldo_dolar) %>% 
  filter(between(sueldo_dolar, poda_p05, poda_p95),
         pais %in% c("Argentina", "Bolivia", "Chile", "Paraguay", "Uruguay", "Perú"))
  
# Gráfico
ggplot(media_pais, aes(x = reorder(pais, -y), y =  y))+
  geom_col(fill = "#344D7E", alpha = 0.85) +
  geom_errorbar(aes(ymin = ymin,ymax = ymax), position = "dodge", color = "#75838F")+
  geom_point(data = sueldo_dolar_pais, aes(x = pais, y = sueldo_dolar), 
             alpha = 0.3, size = 2, color = "#75838F")+
  geom_text(aes(label = round(x=y, 0), vjust = 1.5, fontface = "bold"),size = 4, color = "white")+
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ","))+
  labs(title = "Mediana salarial por país",
       subtitle = "Sueldos de RRHH en U$S",
       caption = "Fuente: Encuesta KIWI de Sueldos de RRHH para Latam \n Países con 5 respuestas o más",
       x = "", y = "") + 
  estilo

```

## Análisis de sueldos por puestos en Latinoamérica

```{r sueldos-puestos-latam}

rh %>% 
  select(puesto, sueldo_dolar) %>% 
  filter(puesto != "Pasante") %>% 
  group_by(puesto) %>% 
  summarise(mediana_salarial = median(sueldo_dolar)) %>% 
  ggplot(aes(x = mediana_salarial, y = puesto)) +
  geom_col(fill = azul) +
  estilov +
  labs(title = "Mediana salarial por puesto", 
       subtitle = "Sueldos de RRHH en U$S", 
       x = "", y = "", 
       caption = fuente) +
  scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ";"))

```

La razón por la cual la mediana salarial de las personas en puesto de **Dirección** es menor a la de las personas en puestos de **Gerente** se explica por el tamaño de la muestra y las respuestas recibidas. En la tabla a continuación incorpora la cantidad de respuestas recibidas para cada uno de estas posiciones.

```{r tabla-puestos}

gt(rh %>% 
     select(puesto, sueldo_dolar) %>% 
     filter(puesto != "Pasante") %>% 
     mutate(puesto = factor(puesto, levels = c("Director", "Gerente", "Jefe", 
                                       "Responsable", "HRBP", "Analista", 
                                       "Administrativo"))) %>% 
     group_by(puesto) %>% 
     summarise(mediana_salarial = median(sueldo_dolar), 
               cant = n())
     ) %>% 
  tab_header(title = "Mediana salarial por puestos", 
             subtitle = "Sueldos en U$D") %>% 
  tab_source_note(source_note = fuente) %>% 
   fmt_currency(columns =  "mediana_salarial", decimals = 0,
               sep_mark = ".", dec_mark = ",") %>% 
  cols_label(puesto = "Posición",
             mediana_salarial = "Mediana Sueldo",
             cant = "Respuestas") 
 
  

```

## Sueldos según el origen del capital

Si dividimos los gráficos según el *Origen del Capital*, podemos apreciar que en líneas generales, la mediana salarial en empresas multinaciones es mayor que en las empresas nacionales.

```{r origen_capital}

rh %>% 
  select(origen_capital, puesto, sueldo_dolar) %>% 
  filter(puesto != "Pasante", 
         between(sueldo_dolar, poda_p05, poda_p95)) %>% 
  group_by(puesto, origen_capital) %>% 
  summarise(mediana_salarial = median(sueldo_dolar)) %>% 
  ggplot(aes(x = mediana_salarial, y = puesto, fill = origen_capital)) +
  geom_col() +
  geom_text(aes(label = round(x=mediana_salarial, 0), hjust = 1.2, fontface = "bold"),size = 3, color = "white") +
  scale_fill_manual(values = c(verde, azul)) +
  estilov +
  scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ",")) +
  facet_wrap(~origen_capital) +
  labs(title = "Mediana salarial por puesto según origen del capital", 
       subtitle = "Sueldos de RRHH en U$S", 
       x = "", y = "", fill = "", 
       caption = fuente) +
  theme(legend.position = "bottom")

```

Veamos estos datos de otra manera:

```{r slope,  fig.height=9}
library(CGPfunctions)

slope_df <- rh %>% 
  select(puesto, sueldo_dolar, origen_capital) %>% 
  filter(puesto != "Director", 
         between(sueldo_dolar, poda_p05, poda_p95)) %>% 
  group_by(puesto, origen_capital) %>% 
  summarise(mediana_salarial = round(median(sueldo_dolar)))

newggslopegraph(dataframe = slope_df,
                Times = origen_capital,
                Measurement = mediana_salarial,
                Grouping = puesto,
                Title = "Diferencias entre sueldos de RRHH en empresas nacionales y multinacionales",
                SubTitle = "Mediana Salarial. Sueldos en U$S",
                Caption = fuente, WiderLabels = T
                
                )

```

Para el análisis de los rubros de la empresa, vamos a filtrar los 5 rubros que tienen más respuestas.

```{r rubro-origen, fig.height=15}
top_5_rubros <- rh %>% 
  select(rubro) %>% 
  group_by(rubro) %>% 
  count(sort = TRUE) %>%
  filter(rubro != "Otros", n > 30) %>% 
  pull(var = rubro)


rh %>% 
  select(rubro, origen_capital, puesto, sueldo_dolar) %>% 
  filter(puesto != "Pasante", 
         between(sueldo_dolar, poda_p05, poda_p95),
         rubro %in% top_5_rubros) %>% 
  group_by(rubro, puesto, origen_capital) %>% 
  summarise(mediana_salarial = median(sueldo_dolar)) %>% 
  ggplot(aes(x = mediana_salarial, y = puesto, fill = origen_capital)) +
  geom_col() +
  geom_text(aes(label = round(x=mediana_salarial, 0), hjust = 1.2, fontface = "bold"),size = 3, color = "white") +
  scale_fill_manual(values = c(verde, azul)) +
  estilo +
  scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ",")) +
  facet_grid(rubro~origen_capital) +
  labs(title = "Mediana salarial por puesto según origen del capital", 
       subtitle = "Sueldos de RRHH en U$S", 
       x = "", y = "", fill = "", 
       caption = fuente) +
  theme(legend.position = "bottom")

rm(top_5_rubros)
```

Para ver las medianas salariales en dólares por rubros, puedes ver esta tabla.

```{r tabla-rubros}

datatable(
  rh %>% 
    select(rubro, sueldo_dolar) %>% 
    group_by(rubro) %>% 
    summarise(mediana_salarial = round(median(sueldo_dolar)),
              Respuestas = n()) %>% 
    arrange(-mediana_salarial),
  colnames = c("Rubro", "Mediana Salarial", "Respuestas"),
  caption = "Mediana salarial por rubro. En U$S"
)

```

# Sueldos Argentina

Teniendo en cuenta que la cantidad mayoritaria de respuestas corresponde a personas de Argentina, vamos a realizar un análisis detallado de los sueldos en este país.

Como primeros pasos, vamos a filtrar los datos correspondientes a Argentina, y luego filtramos los sueldos que estén entre los percentiles 5 y 95, para eliminar valores espurios o extremos que ensucien el análisis.

También eliminamos el puesto de *Director* del análisis y las respuestas con *Género diverso* por la baja cantidad de respuestas.

Otra conversión que hicimos fue pasar los sueldos de las personas que trabajan *part-time* a una equivalencia full-time multiplicando por 1.5 el sueldo completado en la encuesta.

En esta instancia, también simplificamos los nombres de algunos rubros para mejorar las visualizaciones de los resultados.

```{r arg_prep}

rh_ar <- rh %>% 
  filter(pais == "Argentina")


# Poda de sueldos entre percentiles 5 y 95
numericos2 <- rh_ar %>% 
  select_if(is.numeric) %>% 
  profiling_num()

p_05 <- numericos2[8,6]
p_95 <-numericos2[8,10]

rh_ar <- rh_ar %>% 
  filter(between(sueldo_bruto, p_05, p_95),
         puesto != "Director", puesto != "Pasante",
         genero != "Género Diverso",
         anios_experiencia < 50) %>% 
  mutate(rubro = fct_recode(rubro, "Servicios financieros" = "Servicios financieros; seguros",
                             "Transporte" = "Transporte (incluyendo aviación civil; ferrocarriles por carretera)",
                            "Ind. Automotriz y Autopartistas" = "Terminales automotrices, fábricas autopartistas, y afines",
                            "Tecnología" = "Tecnologías de Información, Sistemas, y afines",
                            "Ind. Petrolera" = "Petróleo y producción de gas; refinación de petróleo"),
         multiplicador = if_else(tipo_contratacion == "Part time", 1.5, 1),
         sueldo_ft = sueldo_bruto * multiplicador)


```

## Distribución de sueldos por puesto

En el siguiente gráfico podemos ver la distribución de los sueldos por cada uno de los puestos. En los *boxplots* podemos ver:

-   Primer cuartil: La parte inferior de la caja.

-   Mediana: La línea gruesa dentro de cada rectángulo.

-   Tercer cuartil: La parte superior de la caja

-   Outliers: son los valores extremos identificados con puntos.

```{r box_puestos_ar}

rh_ar %>% 
  ggplot(aes(x = puesto, y = sueldo_ft, fill = genero)) +
  geom_boxplot() +
  scale_fill_manual(values = genero) +
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ";")) +
  estiloh +
  labs(title = "Distribución de sueldos por género",
       subtitle = "Datos de Argentina - en AR$",
       x = "", y = "", fill = "Género",
       caption = fuente) +
  theme(panel.grid.minor.y = element_line(color = "#AEB6BF"))
```

Hay varias cosas interesantes para analizar:

Si miramos las medianas de los puestos, en la mayoría de los puestos hay una paridad relativa, como por ejemplo en *HRBP, Jefe* y *Gerentes.* Tampoco hay mucha diferencia en la mediana de los *Administrativos*. En las posiciones de *Analista,* y *Responsable* los varones tienen una mediana salarial un poco más alta.

Pero lo más interesante son las **distribuciones de los sueldos**. Miremos por ejemplo los Jefes. La mediana es prácticamente la misma, pero *el tamaño de la parte inferior de la caja es mucho más amplia en el caso de las mujeres,* mientras que la parte superior de la caja es más amplia en el caso de los varones.

Esto nos da la pauta que si bien el valor que divide a la mitad la muestra de hombres y mujeres (la mediana) es muy parejo, el rango de los sueldos de las Jefas llega a valores más bajos lo que implica que el piso es más bajo para mujeres que para hombres. Mientras que de la mediana *hacia arriba* es más amplia en el caso de los hombres en comparación con las mujeres.

En el único puesto que hay una distribución similar entre ambos géneros es en el caso de los HRBP, pero en el resto de los casos vemos que la asimetría que describimos anteriormente se repite.

Veamos el sueldo promedio en cada uno de los rubros.

## Análisis por rubros

En el gráfico a continuación podemos ver los sueldos promedios por rubro, teniendo en cuenta a los rubros con más de 12 respuestas.

```{r rubros_ar}

rubro_ar <- rh_ar %>% 
  select(rubro, sueldo_ft) %>% 
  group_by(rubro) %>% 
  summarise(media_sueldo = mean(sueldo_ft),
            respuestas = n()) %>% 
  arrange(-respuestas)

top_rubros <- rubro_ar %>% 
  filter(rubro != "Otros", respuestas > 15) %>% 
  pull(rubro)

rubro_ar %>% 
  filter(respuestas > 12) %>% 
  ggplot(aes(x = media_sueldo, y = reorder(rubro, media_sueldo))) +
  geom_col(fill = azul) +
  geom_text(aes(label = round(x=media_sueldo, 0), hjust = 1.5),size = 3, color = "white") +
  labs(title = "Promedio salarial por rubro",
       subtitle = "Datos de Argentina - en AR$",
       x = "", y = "",
       caption = fuente) +
  estilov +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank())


```

Ahora comparemos los sueldos por rubros y géneros. Aquí podremos apreciar las diferencias entre los sueldos promedios de los hombres y mujeres en cada rubro.

```{r rubro_genero_ar}

rh_ar %>% 
  filter(rubro %in% top_rubros) %>% 
  select(rubro, sueldo_ft, genero) %>% 
  group_by(rubro, genero) %>% 
  summarise(media_sueldo = mean(sueldo_ft),
            respuestas = n()) %>% 
  arrange(-respuestas) %>% 
  ggplot(aes(x = media_sueldo, y = reorder(rubro, media_sueldo), fill = genero)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = round(x=media_sueldo,0), hjust = 1.4, vjust = 0.3),
            size = 3, color = "white", position = position_dodge(width = .9)) +
  scale_fill_manual(values = genero) +
  labs(title = "Promedio salarial por rubro y género",
       subtitle = "Datos de Argentina - en AR$",
       x = "", y = "", fill = "Género",
       caption = fuente) +
  scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ";")) +
  estilov +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank())

```

Por último, analicemos los sueldos de los 6 rubros con mayor cantidad de respuestas, y visualicemos las distribuciones de los sueldos por puesto y género. En este gráfico podemos ver los cuartiles delimitando las zonas sombreadas, y la mediana con el punto gris. Los puntos violetas y verdes representan a las mujeres y los hombres respectivamente en cada uno de los puestos.

```{r dist_rubro_gen, out.width="90%", fig.height=7}
library(ggeconodist)

rh_ar %>% 
  filter(genero != "Género Diverso",
         puesto != "Director",
         rubro %in% c("Tecnología", "Servicios de salud", "Comercio",
                      "Alimentación; bebidas; tabaco",
                      "Servicios de consultoría", "Construcción"))  %>% 
  ggplot(aes(x = puesto, y = sueldo_bruto)) +
  geom_econodist(width = 0.5) +
  geom_point(aes(y = sueldo_bruto, color = genero), alpha = 0.3,
             position = position_jitter(width = 0.25)) +
  scale_color_manual(values = genero) +
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ";")) +
  coord_flip() +
  facet_wrap(~rubro, ncol = 2) +
  estilov +
  labs(title = "Distribución salarial por puesto y rubro",
       subtitle = "Datos de Argentina - en AR$",
       x = "", y = "", color = "Género",
       caption = fuente)

```

## Relaciones con Sueldo Bruto

En esta sección del análisis buscamos identificar cuáles son los factores que influyen en los ingresos (independientemente de la posición), así que empezamos a explorar los datos.

La primera pregunta que nos hicimos fue si los años de trayectoria influyen en el sueldo. Nuestra hipótesis es que a mayor cantidad de años de experiencia, mayor iba a ser el ingreso.

Lo que vamos a ver en el siguiente gráfico de dispersión, es en el eje horizontal, los años de experiencia, y en el eje vertical, el sueldo bruto expresado en pesos argentinos. Luego, vamos a graficar una recta, que nos va a indicar la *fuerza* de esa relación.

### Relación entre años de experiencia y sueldo bruto

```{r reg_lineal_1}
lm_rh <- lm(sueldo_ft ~ anios_experiencia, data = rh_ar)

lm_hr_results <- summary(lm_rh)

lm_rh_r2 <- round(lm_hr_results[["r.squared"]],3)

ggplot(rh_ar, aes(x=anios_experiencia, y = sueldo_ft)) +
  geom_point(color = "#1FC3AA", alpha = 0.4, size = 2) + 
  geom_smooth(method = "lm") +
  theme_minimal() +
  theme(text = element_text(family = "Roboto")) +
  labs(title = "Relación entre sueldo y años de experiencia",
       x = "Años de Experiencia",
       y = "Sueldo bruto (AR$)", 
       caption = fuente) +
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ";")) +
  geom_text(aes(x=-Inf, y=Inf, hjust=0, vjust=1, label= paste0("R2 = ", lm_rh_r2))) 

```

En el gráfico podemos apreciar una recta que va creciendo efectivamente: a medida que nos movemos más hacia la derecha, la recta va subiendo. Pero el $R^2$ = `r lm_rh_r2` nos indica cuánto explica los años de experiencia sobre el sueldo bruto, o dicho de otra manera, en qué medida influye la variable x (años de experiencia), sobre la variable y (sueldo bruto). Una definición más precisa de este valor conocido como **Coeficiente de Determinación** es la proporción de la varianza total de la variable explicada por la regresión.

Este valor puede estar entre 0 y 1, mientras más cerca de 0 está menor es la relación, y mientras más cerca de 1 esté el resultado, indica que la regresión explica la variabilidad de la variable de respuesta. Es por eso que este $R^2$ = `r lm_rh_r2` nos indica que los años de experiencia no tienen mucha influencia en los sueldos.

### Relación entre años de experiencia y sueldo bruto por puesto.

Dado que en el gráfico anterior tenemos mezclados los sueldos de administrativos, analistas, jefes y gerentes, decidimos analizar la relación entre los años de experiencia y el sueldo bruto por cada uno de los puestos por separado.

```{r reg_lineal_2, out.width="90%"}
library(ggpmisc)

mi.formula <- y ~ x

ggplot(rh_ar, aes(x=anios_experiencia, y = sueldo_ft)) +
  geom_point(color = "#1FC3AA", alpha = 0.4, size = 2) + 
  geom_smooth(method = "lm", formula = mi.formula, se = FALSE) +
  theme_minimal() +
  theme(text = element_text(family = "Roboto")) +
  labs(title = "Relación entre sueldo y años de experiencia",
       x = "Años de Experiencia",
       y = "", 
       caption = fuente) +
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ";")) +
  stat_poly_eq(formula = mi.formula, 
               aes(label = paste(..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  facet_wrap(~puesto)

```

Como podemos apreciar en los $R^2$ de cada gráfico. Los años de trayectoria influyen muy poco en los sueldos de cada uno de los puestos.

# Educación

En esta sección queremos indagar si hay relación entre la formación y la remuneración, y si impacta también el tipo de universidad, pública o privada, en la remuneración y posición. Primero veamos entre los distintos países como se distribuye la muestra entre profesionales provenientes de universidades públicas y privadas.

Dado que tenemos relativamente pocas respuestas de otros países que no sean Argentina, no podemos sacar ninguna conclusión seria, sólo mencionar que en Argentina, hay una virtual paridad entre los estudiantes y graduados de universidades públicas y privadas. Posteriormente analizaremos la situación por regiones dentro del país.

Las proporciones de respuestas según al tipo de universidad que asistieron los participantes de la encuesta es la siguiente:

```{r tipo_universidad, fig.show="hold", out.width="50%", fig.align = "default"}
rh %>% 
  select(pais, tipo_universidad) %>% 
  ggplot(aes(y = pais, fill = tipo_universidad)) +
           geom_bar(position = "fill") + 
  scale_fill_manual(values = c(gris, verde, azul)) +
  labs(title = "Distribución de respuestas por tipo de universidad por país",
       caption = fuente, 
       x = "", y = "") +
  estilo +
  theme(legend.position = "none")


educ <- rh %>% 
  select(tipo_universidad) %>%  
  group_by(tipo_universidad) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

# Compute the cumulative percentages (top of each rectangle)
educ$ymax <- cumsum(educ$freq)

# Compute the bottom of each rectangle
educ$ymin <- c(0, head(educ$ymax, n=-1))

# Compute label position
educ$labelPosition <- (educ$ymax + educ$ymin) / 2

# Compute a good label
educ$label <- paste0(educ$tipo_universidad, "\n Cant: ", educ$n)

# Make the plot
ggplot(educ, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=tipo_universidad)) +
  geom_rect() +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(2, 4)) +# Try to remove that to see how to make a pie chart
  scale_fill_manual(values = c(gris, verde, azul)) +
  theme_void() +
  theme(legend.position = "right",
        panel.background = element_blank(),
        text = element_text(family = "Roboto")) +
  labs(title = "Tipo de Universidad",
       fill = "Tipo de Universidad", 
       caption = fuente) +
  theme(legend.position = "left")
```

Las principales carreras de las personas que respondieron son:

```{r carreras}
carreras <- rh %>% 
  select(nivel_formacion, carrera_grado, tipo_universidad, trabajo, 
         sueldo_bruto, puesto, funcion_rh, pais, genero) %>% 
  mutate(carrera_grado = factor(carrera_grado))

carreras <- carreras %>% 
  mutate(carrera_grado = fct_collapse(carrera_grado, 
                                      "Abogacía" = c("Abogacía, Escribanía, Lic en RRHH")),
         carrera_grado = fct_collapse(carrera_grado, 
                                      "Administración de Empresas" = c("Lic en Administracion",
                                                                       "Administración y sistemas", "Lic Administracion - Contador Publico - Abogado en curso")),
         carrera_grado = fct_collapse(carrera_grado, 
                                      "Contador Público" = c("Economia", "Economía", "Contador Público/Lic. En Letras", "Economia y RR.HH")),
         carrera_grado = fct_collapse(carrera_grado, 
                                      "Comunicación Social" = c("Caomunicacion social me especialice en RRHH",  "Comunicación","Comunicación social", "Lic. en Ciencias de la Comunicación")), 
         carrera_grado = fct_collapse(carrera_grado, 
                                      "RRHH / RRLL / RRTT" = c("Estudié en la Universidad Analista en Recursos Humanos", "RRHH&Coaching ontologico profesional.", "Graduada en lic rrhh y abogacia")),
         carrera_grado = fct_collapse(carrera_grado, "Ingenierías" = c("Ing en sistemas", "Ing. Financiera", "Ingeniería Comercial", "ING.sistemas",  "Ingenieria Electrónica","Ingeniería Industrial")),
         carrera_grado = fct_collapse(carrera_grado, 
                                      "Psicología" = c("Psicologia","Psicología Industrial", "Psicología social",   "Psicología Social / Lic. en Dirección de las Organizaciones")),
         carrera_grado = fct_collapse(carrera_grado, "No estudié en la Universidad" = "Ninguna"),
         carrera_grado = fct_lump(carrera_grado, 
                                  prop = 0.02, 
                                  other_level = "Otros"),
         carrera_grado = factor(carrera_grado,
                                levels = c("RRHH / RRLL / RRTT", "Psicología", "Administración de Empresas", "Contador Público", "Otros")))


ggplot(carreras, aes(x = carrera_grado)) + 
  geom_bar(position = "dodge", fill = azul) +
  theme(axis.text.x = element_text(angle = 90)) + 
  labs(x="",y="") +
  estiloh +
  labs(title = "Principales carreras estudiadas",
       subtitle = "Trabajadores en relación de dependencia",
       caption = fuente)

```

Dada la cantidad de respuestas por país, el análisis que haremos desde aquí en adelante sólo será para **Argentina**.

## Análisis de educación y puestos para Argentina

Luego, podemos analizar en qué tipo de universidad estudiaron las personas que respondieron la encuesta, según el puesto actual que ocupan.

```{r puesto-universidad}
recorte_educacion <- rh %>%
  filter(pais == "Argentina") %>% 
  select(nivel_formacion, carrera_grado,
         tipo_universidad, trabajo, sueldo_bruto, puesto, funcion_rh, pais, genero)

ggplot(recorte_educacion, (aes(x = puesto, fill = tipo_universidad))) + #Tipo de universidad y cargo
  geom_bar(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90)) + 
  labs(x="",y="") +
    estilov +
  scale_fill_manual(values = c(gris, verde, azul)) +
  coord_flip() +
  labs(title = "Cantidad de respuestas según puesto y universidad",
       subtitle = "Sólo respuestas de Argentina",
       x = "", fill = "Tipo de Universidad",
       caption = fuente)
```

Reiteremos el análisis pero únicamente para las carreras relacionadas con Recursos Humanos y Relaciones del Trabajo.

```{r rh-psico}
recorte_educacion %>%
  filter(carrera_grado == "RRHH / RRLL / RRTT") %>% 
  ggplot(aes(x = puesto, fill = tipo_universidad)) + #Tipo de universidad y cargo
  geom_bar(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90)) + 
  labs(x="",y="") +
    estilov +
  scale_fill_manual(values = c(gris, verde, azul)) +
  coord_flip() +
  labs(title = "Cantidad de respuestas según puesto y universidad",
       subtitle = "Sólo respuestas de Argentina - Carreras de RH",
       x = "", fill = "Tipo de Universidad",
       caption = fuente)
  

```

Podemos apreciar que a partir de los puestos de jefatura, hay mayor presencia de graduados provenientes de universidades privadas.

En Argentina, podemos ver la siguiente distribución por género y nivel educativo.

```{r nivel-ed-genero}

ne_salario <- recorte_educacion 

ne_salario %>% 
  select(pais, nivel_formacion, genero, puesto) %>%
  filter(genero != "Género Diverso") %>%
  mutate(nivel_formacion = factor(nivel_formacion,
                                  levels = c("Secundario completo", "Terciario completo",
                                             "Universitario en curso", "Universitario completo",
                                             "Maestría en curso","Maestría completa"))) %>% 
  group_by(nivel_formacion) %>% 
  ggplot(aes (y= nivel_formacion, fill = genero)) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 90)) + 
  labs(x="",y="") +
  scale_fill_manual(values = colores) +
  estilo +
  theme(legend.position = "top") +
  labs(title = "Máximo nivel educativo alcanzado por género",
       subtitle = "Distribución por frecuencias absolutas",
       caption = fuente, 
       fill = "Género")

```

En términos absolutos, las mujeres graduadas representan cerca del 70% de la muestra. Analicemos estos datos en términos relativos. Prácticamente el patrón de nivel educativo entre hombres y mujeres es idéntico.

```{r nivel-ed-genero-rel}
ne_fem <- ne_salario %>% 
  filter(genero == "Femenino") %>% 
  group_by(genero, nivel_formacion) %>% 
  mutate(nivel_formacion = factor(nivel_formacion,
                                  levels = c("Maestría completa", "Maestría en curso",
                                             "Universitario completo", "Universitario en curso",
                                             "Terciario completo", "Secundario completo"))) %>% 
  group_by(nivel_formacion) %>% 
  summarise(n = n()) %>% 
  mutate(frecuencia = round(n/sum(n),2),
         genero = "Femenino") 

ne_mas <- ne_salario %>% 
  filter(genero == "Masculino") %>% 
  group_by(genero, nivel_formacion) %>% 
  mutate(nivel_formacion = factor(nivel_formacion,
                                  levels = c("Maestría completa", "Maestría en curso",
                                             "Universitario completo", "Universitario en curso",
                                             "Terciario completo", "Secundario completo"))) %>% 
  group_by(nivel_formacion) %>% 
  summarise(n = n()) %>% 
  mutate(frecuencia = round(n/sum(n),2),
         genero = "Masculino") 

ne_total <- rbind(ne_fem, ne_mas)

ggplot(ne_total, aes(x = nivel_formacion, y = frecuencia, fill = genero)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90), 
        legend.position = "none") + 
  labs(x="",y="") +
  scale_fill_manual(values = colores) +
  facet_wrap(~genero, ncol = 2) +
  estiloh +
  labs(title = "Proporción de nivel educativo máximo por género",
       x = "", y = "Proporción", 
       caption = fuente)

```

Ahora veamos como se distribuyen los puestos según el género y el nivel educativo.

```{r puestos-nivel-ed, fig.height=8}
ne_salario %>% 
  select(pais, nivel_formacion, genero, puesto) %>%
  filter(genero %in% c("Femenino", "Masculino"),
         puesto != "Pasante", puesto != "Director") %>%
  mutate(nivel_formacion = factor(nivel_formacion,
                                  levels = c("Secundario completo", "Terciario completo",
                                             "Universitario en curso", "Universitario completo",
                                             "Maestría en curso","Maestría completa")),
         puesto = factor(puesto, 
                         levels = c("Director", "Gerente", "Jefe", "Responsable", "HRBP",
                                    "Analista", "Administrativo"))) %>% 
  group_by(nivel_formacion) %>% 
  ggplot(aes (y= nivel_formacion, fill = genero)) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 90)) + 
  labs(x="",y="") +
  scale_fill_manual(values = colores) +
  estilo +
  theme(legend.position = "bottom") +
  labs(title = "Nivel educativo por puesto y género",
       subtitle = "Distribución por frecuencias absolutas",
       caption = fuente, 
       fill = "Género") +
  facet_wrap(~puesto, ncol = 3)

```

Algunas conclusiones que podemos extraer del gráfico anterior:

-   Hay una fuerte predominancia de mujeres en puestos de baja jerarquía.
-   En los puestos de Gerencia y de Jefatura hay mayor predominancia de varones, pero aún así hay una paridad entre los distintos niveles educativos.
-   Posiciones altamente especializadas, como la de HRBP, requiere una formación universitaria.

Analicemos las proporciones de hombres y de mujeres en puesto de liderazgo.

```{r liderazgo-genero, results='hide'}
div <- rh %>%
  filter(pais == "Argentina") %>% 
select(genero) %>% 
  mutate(genero = factor(genero, 
                         levels = c("Femenino", "Masculino", 
                                    "No binario", "Prefiero no responder"))) %>% 
  group_by(genero) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

lideres <- rh %>% 
  filter(pais == "Argentina") %>% 
 select(genero, puesto) %>% 
  mutate(genero = fct_recode(genero,
                             "No binario" = "Género diverso (género diverso / género fluido /otras minorías)"))

# Propoción de líderes hombres y mujeres
lideres_genero <- lideres %>% 
  filter(genero %in% c("Masculino","Femenino")) %>% 
  group_by(genero) %>%
  mutate(gente_a_cargo = if_else(puesto %in% c("Responsable", "Jefe", "Gerente", 
                                               "Supervisor", "Director"),1,0)) %>%
  summarise(lider = sum(gente_a_cargo)) %>% 
  left_join(div) %>% 
  select(genero, lider, n) %>% 
  mutate(proporcion = percent(lider/n))

# Test de hipótesis para validar diferencias de resultados
# Hay que verificar si la proporción de líderes hombres es mayor que la proporción de líderes mujeres
# Creo un dataframe para analizar proporciones de hombres y de mujeres en puestos de liderazgo y de no-liderazgo
test_lider <- lideres_genero %>% 
  mutate(no_lider = n - lider) %>%        # Columna de no líderes
  select(genero, lider, no_lider) %>%     # selecciono columnas de interés
  pivot_longer(cols = c(lider, no_lider), # Hago un dataset largo para analizar después
               names_to = "es_lider", values_to = "conteo")

# Del total de respuestas me interesa sólo ver cuáles son los hombres con puesto de liderazgo
test_lider$cat <- c(0,0,1,0)

# Extraigo el mu para decidir si la diferencia es significativa y pasarlo a la fórmula del test.
prop_mujer_lid <- pull(lideres_genero[1,2]/lideres_genero[1,3])

# Realizo el test de hipótesis.
# H0 = Las proporciones de líderes hombres y mujeres son iguales
# H1 = La proporción de hombres líderes es mayor que la proporción de mujeres líderes.
resultados_test <- broom::tidy(t.test(test_lider$cat, mu = prop_mujer_lid, alternative = "greater"))

valor_test <- if(resultados_test[1,3] > 0.05) {
  print("la diferencia es estadísticamente significativa, y la proporción de hombres en puestos de liderazgo es mayor que el de las mujeres")
  } else {
    print("la diferencia no es estadísticamente significativa, y la proporción de hombres no es estadísticamente mayor que el de las mujeres en puestos de liderazgo")
  }
```

```{r grafico-prop-lid-genero}
# Gráfico
lideres_genero %>% 
  mutate(porc_lider = lider/n, 
         porc_no_lider = 1 - porc_lider) %>% 
  pivot_longer(cols = c(porc_lider, porc_no_lider),
               names_to = "es_lider", 
               values_to = "valores") %>% 
  mutate(es_lider = factor(es_lider, 
                           levels = c("porc_no_lider", "porc_lider"), 
                           labels = c("No Líder", "Líder"))) %>% 
  ggplot(aes(x= genero, y = valores, fill = es_lider))+
  geom_col(position = "fill")+
  estilo +
  scale_fill_manual(values = c("#75838F", "#344D7E")) +
  labs(title = "Proporción de Líderes según género",
       x = "", y = "", fill = "", 
       caption = fuente)

```

De acuerdo a las respuestas recolectadas **2 de cada 3** participantes son mujeres.

Para los puestos de liderazgo consideramos las personas en los puestos de *Director, Gerente, Jefe, y Responsable.*

Del total de **mujeres**, `r lideres_genero[1,3]` respuestas, `r lideres_genero[1,2]` ocupan un puesto de liderazgo (`r lideres_genero[1, 4]`).

Del total de **hombres**, `r lideres_genero[2, 3]` respuestas, `r lideres_genero[2,2]` ocupan un puesto de liderazgo (`r lideres_genero[2, 4]`).

Con un *p-value* igual a `r round(resultados_test[1,3],3)` podemos afirmar que **`r valor_test`**.

## Análisis de sueldos y educación en Argentina

En esta sección analizaremos los sueldos en comparación con los distintos niveles educativos.

A diferencia de otras secciones, en este caso compararemos la *media salarial* para poder observar los desvíos estándar en los análisis. En primer lugar analicemos cuál es el sueldo promedio de acuerdo a los distintos niveles educativos.

Primero veamos cuál es el sueldo promedio en pesos argentinos, según el nivel educativo.

```{r sueldo-educ}
estudios <- rh %>% 
  filter(pais == "Argentina") %>% 
  select(genero, nivel_formacion, sueldo_bruto)
    
  
est_ar  <- profiling_num(estudios)
es_p05 <- 29320
es_p95 <- 210000

rh %>% 
  filter(pais == "Argentina", 
         between(sueldo_bruto, es_p05, es_p95)) %>% 
    mutate(nivel_formacion = factor(nivel_formacion,
                                  levels = c("Secundario completo", "Terciario completo",
                                             "Universitario en curso", "Universitario completo",
                                             "Maestría en curso","Maestría completa"))) %>% 
  group_by(nivel_formacion) %>% 
  summarise(sueldo_promedio = mean(sueldo_bruto)) %>% 
  ggplot(aes(x = sueldo_promedio, y = nivel_formacion))+
  geom_col(fill = azul)+
  estilov +
  scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ".")) +
  labs(title = "Sueldo promedio por nivel de formación",
       subtitle = "En AR$",
       x="", y="", caption = fuente)

  

```

Ahora veamos qué pasa si incluimos en el análisis el género para analizar los sueldos promedios y sus desvíos estándar.

```{r sueldo-educ-genero}
rh %>% 
  filter(pais == "Argentina", 
         between(sueldo_bruto, es_p05, es_p95)) %>% 
    mutate(nivel_formacion = factor(nivel_formacion,
                                  levels = c("Secundario completo", "Terciario completo",
                                             "Universitario en curso", "Universitario completo",
                                             "Maestría en curso","Maestría completa"))) %>% 
  group_by(nivel_formacion, genero) %>% 
  summarise(salarios = list(mean_se(sueldo_bruto))) %>% 
  unnest(salarios) %>% 
  ggplot(aes(x = nivel_formacion, y = y, fill = genero)) +
  geom_col(position = "dodge")+
  geom_errorbar(aes(ymin = ymin,ymax = ymax), position = "dodge")+
  coord_flip()+
  theme(legend.position = "bottom") +
  scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ".")) +
  estilov +
  scale_fill_manual(values = genero3) +
  labs(title = "Sueldo promedio y desvío estándard por nivel de formación y género",
       subtitle = "En AR$", 
       x = "", y = "", 
       caption = fuente, 
       fill = "Género")
```

# Otros Análisis

## Relación entre satisfacción y sueldos

Para este análisis nos preguntamos si hay relación entre el nivel salarial y la satisfacción.

Para responder a esta pregunta, cruzamos los sueldos brutos de Argentina, contra los niveles de satisfacción con la actual empresa donde trabajan las personas que respondieron la encuesta.

Los pasos que seguimos fueron los siguientes:

-   A los sueldos brutos los segmentamos en 4 partes con igual cantidad de registros (cuartiles). Es decir, en el 1° cuartil tenemos el 25% de los datos, en el segundo cuartil tenemos el 50% de los datos, y en el 3° cuartil tenemos el 75% de los datos.
-   En el primer cuartil están los sueldos más bajos, y el 4° los más altos.
-   Los niveles de satisfacción van del 1 (Totalmente Insatisfecho), al 5, (Totalmente Satisfecho).

```{r satisf, out.width="85%"}
library(ggalluvial)

satisf <- rh %>% 
  filter(!is.na(satisfaccion),
         genero %in% c("Femenino", "Masculino"),
         pais == "Argentina") %>% 
  select(genero, sueldo_bruto, satisfaccion)


p25 <- profiling_num(satisf)[1,7]
p50 <- profiling_num(satisf)[1,8]
p75 <- profiling_num(satisf)[1,9]

satisf <- satisf %>% 
  mutate(cuartil = factor(case_when(
    sueldo_bruto  <   p25  ~ "1Q",
    sueldo_bruto > p25 & sueldo_bruto < p50 ~ "2Q",
    sueldo_bruto > p50 & sueldo_bruto < p75 ~ "3Q",
    TRUE   ~ "4Q")),
    satisfaccion = factor(satisfaccion, 
                             levels = c("1","2","3","4","5")), 
    cuenta = 1)


satisf <- satisf %>% 
  group_by(genero, satisfaccion, cuartil) %>% 
  summarise(cant = n())



ggplot(as.data.frame(satisf), aes(y = cant, axis1 = cuartil, axis2 = satisfaccion)) +
  geom_alluvium(aes(fill = genero), width = 1/12, alpha = 0.4) +
  geom_stratum(width = 1/12, fill = "#8882F7") +
  geom_label(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Sueldo Bruto por Cuartil", "Nivel de Satisfacción"), expand = c(.05, .05)) +
  scale_fill_manual(values = colores) +
  estilo +
  labs(title = "Relación entre nivel salarial y satisfacción con la empresa",
       y = "", caption = fuente, fill = "Género")

```
